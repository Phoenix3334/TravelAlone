[toc]

# CityMate——基于MVVM的城市信息助手

## 1 项目介绍

本项目是一款基于 Android Studio 平台开发的城市信息助手应用，项目使用Kotlin语言进行开发，整体上采用 MVVM 架构、Jetpack Compose UI 和 Retrofit 网络请求框架。通过调取第三方API实现了天气查询、新闻浏览和智能对话功能。该应用能够整合多源信息，为用户提供实时、便捷的城市信息服务，同时支持快速扩展和功能迭代。

**详细的产品功能包括：**

1. **城市天气查询**

   - 用户可输入城市名称获取当前天气、温度、风速、空气质量等信息。

   - 支持未来 4 天的天气预报显示。

   - UI 使用 Compose 实现动态天气图标和背景，增强视觉体验。


2. **城市新闻查询**

   - 提供基于城市的新闻头条与重要事件推送。

   - 自动更新最新资讯，可以显示新闻详情的图片，标题，时间与报道方。
   - 新闻内容支持点击跳转查看详情。


3. **智能对话助手**

   - 用户可以与应用进行自然语言交互，获取天气、新闻或常规问答服务。

   - 对话功能基于调用云端 API 实现，具体是使用了DeepSeek的交流API。


## 2 开发环境

1. **操作系统**: Windows 10 或更高版本。

2. **Java 开发工具包 (JDK)**: 需要安装 JDK 11 或更高版本。
   - 推荐使用 [AdoptOpenJDK](https://adoptopenjdk.net/) 或 [Oracle JDK](https://www.oracle.com/java/technologies/javase-downloads.html)。
   
3. **Gradle 构建工具**: 项目使用 Gradle 构建，推荐使用 Gradle 7.0 或更高版本。
   - 项目已包含 Gradle Wrapper (`gradlew` 和 `gradlew.bat`)，无需单独安装 Gradle。
   
4. **Android Studio**: 推荐使用 Android Studio Flamingo 或更高版本。
   - 确保安装 Android SDK 和相关工具包。
   
5. **虚拟设备开发配置**：

   - Android SDK ：API 33 "Tiramisu"; Android 13.0

   - System image ：Google APIs Intel x86_64 Atom System Image

## 3 需求设计

### 3.1 功能性需求

#### 3.1.1 天气查询子系统

![用例图-天气查询.drawio](./images/readme.md/用例图-天气查询.drawio.png)

| **项目**     | **描述**                                                     |
| :----------- | ------------------------------------------------------------ |
| **名称**     | 天气查询子系统                                               |
| **概览**     | 该子系统用于为用户提供城市天气信息查询服务。用户可输入城市名称，系统通过调用第三方天气 API 获取实时天气数据，并以直观的方式展示当前天气状况，包括温度、天气现象、湿度等基础信息，帮助用户快速了解目标城市的天气情况。 |
| **参与人员** | 用户（User）、系统（System）、第三方天气服务（Weather API）  |
| **基本路径** | 1. 用户进入天气查询界面。<br/>2. 用户输入城市名称并提交查询请求。<br/>3. 系统对用户输入进行合法性校验（非空、格式正确）。<br/>4. 系统向第三方天气 API 发送请求。<br/>5. 系统接收并解析返回的天气数据。<br/>6. 系统将天气信息展示在界面上。 |
| **额外路径** | 1. 城市名称无效或不存在<br/>1.1 系统返回错误信息提示“未找到该城市的天气信息”。<br/>1.2 用户重新输入城市名称。<br/>2. 网络异常或 API 请求失败<br/>2.1 系统提示“网络异常，请稍后重试”。<br/>2.2 保留当前界面，等待用户重新发起查询。 |
| **后置条件** | 系统成功展示目标城市的天气信息；若查询失败，系统记录错误状态但不影响应用其他功能的正常使用。 |

#### 3.1.2 新闻查询子系统

![用例图-新闻查询.drawio](./images/readme.md/用例图-新闻查询.drawio.png)

| **项目**     | **描述**                                                     |
| ------------ | ------------------------------------------------------------ |
| **名称**     | 新闻查询子系统                                               |
| **概览**     | 该子系统用于为用户提供基于城市或关键词的新闻资讯查询服务。用户可查看与目标城市相关的最新新闻信息，包括新闻标题、来源、发布时间、摘要及配图，帮助用户快速了解城市动态与热点事件。 |
| **参与人员** | 用户（User）、系统（System）、第三方新闻服务（News API）     |
| **基本路径** | 1. 用户进入新闻查询界面。2. 系统自动或根据用户操作发起新闻数据请求。3. 系统向第三方新闻 API 发送请求。4. 系统接收并解析新闻数据。5. 系统以列表卡片形式展示新闻标题、来源、发布时间等信息。6. 用户点击新闻卡片，系统跳转至浏览器打开新闻原文链接。 |
| **额外路径** | 1. 未查询到相关新闻1.1 系统提示“暂无相关新闻内容”。1.2 页面保持可刷新状态。2. 网络异常或接口调用失败2.1 系统提示“新闻加载失败，请稍后重试”。2.2 用户可重新刷新页面。 |
| **后置条件** | 系统成功展示新闻列表或给出合理的错误提示；用户可通过外部浏览器继续阅读完整新闻内容。 |

#### 3.1.3 智能对话子系统

![用例图- 智能对话.drawio](./images/readme.md/用例图- 智能对话.drawio.png)

| **项目**     | **描述**                                                     |
| ------------ | ------------------------------------------------------------ |
| **名称**     | 智能对话子系统                                               |
| **概览**     | 该子系统为用户提供基于大语言模型的智能对话服务。用户可以通过自然语言向系统提问，系统对用户输入进行语义理解，并生成相应的智能回复，用于信息咨询、简单问答及辅助决策。 |
| **参与人员** | 用户（User）、系统（System）、大语言模型服务（LLM API）      |
| **基本路径** | 1. 用户进入智能对话界面。2. 用户输入问题并发送消息。3. 系统将用户输入发送至大语言模型接口。4. 系统接收模型返回的回复内容。5. 系统以对话气泡形式展示用户问题与智能回复。 |
| **额外路径** | 1. 用户输入为空1.1 系统禁止发送请求并提示用户输入内容。2. 模型接口请求失败2.1 系统提示“服务暂时不可用，请稍后重试”。3. 响应时间过长3.1 系统显示“思考中”加载状态提示。 |
| **后置条件** | 系统记录本次对话内容并展示完整对话历史；即使请求失败，也不影响用户继续使用其他功能模块。 |

### 3.2 非功能性需求

1. **性能需求：**系统在正常网络环境下应具有良好的响应性能。天气查询与新闻查询功能在用户发起请求后，应在合理时间内完成数据获取与界面展示，一般不超过 3 秒。智能对话功能在发送问题后，应在较短时间内返回回复结果，避免用户长时间等待。系统在多功能并行使用时应保持界面流畅，避免卡顿或阻塞现象。

2. **可用性需求：**系统界面应简洁直观，操作逻辑清晰，用户无需复杂学习即可完成主要功能操作。各功能模块在数据加载、请求成功或失败时，应向用户提供明确的交互反馈，如加载提示、成功提示或错误信息说明。系统应具备一定的容错能力，当用户输入非法或空内容时，应进行提示而非导致程序异常终止。

3. **兼容性需求：**系统应支持主流 Android 设备，能够适配不同尺寸与分辨率的屏幕。应用应兼容 Android 8.0 及以上版本系统，并在常见网络环境（Wi-Fi 与移动数据网络）下均能正常运行。

4. **安全性需求：**系统在与第三方接口进行数据交互时应采用安全的网络传输方式，避免数据泄露风险。对用户输入的数据进行基本校验，防止异常输入影响系统运行。第三方接口密钥等敏感信息不直接暴露在用户界面中，降低安全隐患。

5. **可维护性与可扩展性需求：**系统整体架构应清晰，模块划分合理，便于后期维护与功能扩展。各功能模块之间应保持较低耦合度，在新增或修改功能时，不应对已有功能产生明显影响。智能对话模块应支持替换不同的大模型服务，具备良好的扩展能力。

### 3.3 其他需求

1. **运行环境需求：**本系统运行于 Android 移动设备平台，开发语言为 Kotlin，采用 Android Studio 作为开发工具。系统运行过程中需要设备具备稳定的网络连接，以保证天气、新闻及智能对话等功能能够正常访问第三方服务接口。

2. **部署与运行需求：**系统以 APK 形式进行部署，用户通过安装 APK 文件即可在 Android 设备上运行应用。系统启动后无需额外配置即可使用主要功能，后续功能更新可通过重新安装新版 APK 实现。

3. **技术与使用约束：**系统采用 MVVM 架构与 Jetpack Compose 技术进行界面开发，需遵循相关技术规范。系统依赖第三方开放接口获取数据，接口访问频率及数据准确性受外部服务限制。系统主要面向日常城市信息查询与智能辅助使用场景。

4. **后续扩展需求：**在现有功能基础上，系统未来可扩展城市地图展示、出行规划及生活服务推荐等模块；在交互层面，可引入语音输入、多轮对话优化等功能，以进一步提升用户体验。

## 4 概要设计

### 4.1 架构概要设计

![架构图-架构图.drawio](./images/readme.md/架构图-架构图.drawio.png)

本系统整体采用 **MVVM（Model–View–ViewModel）架构模式** 进行设计，并基于 Android Jetpack 组件与 Jetpack Compose 构建用户界面。系统按照功能与职责划分为表示层、业务逻辑层和数据层，各层之间通过明确的接口进行交互，从而提高系统的可维护性与可扩展性。

系统整体架构采用三层结构，自上而下依次为表示层、业务逻辑层和数据层，各层之间通过明确的接口进行交互，避免跨层直接依赖。

可以，我帮你补全每个组件的内容，使其完整、条理清晰，适合直接放在说明文档中：

#### 4.1.1 表示层（Presentation Layer）

表示层负责系统的界面展示与用户交互，是用户与系统进行信息交互的入口。本层不包含具体业务规则，仅负责将业务逻辑层提供的数据以可视化形式呈现，并将用户操作事件传递给业务逻辑层。

表示层主要由以下组件构成：

- **界面展示组件（UI Screens）**
  包括天气查询界面、新闻列表界面、智能对话界面等，负责将数据以文本、列表、卡片或对话形式直观展示给用户。
- **页面导航组件（Navigation）**
  管理不同界面之间的跳转和状态维护，例如从主页面跳转到天气详情页或新闻详情页，同时维护界面堆栈和返回逻辑。
- **状态感知组件（UI State）**
  通过观察 ViewModel 暴露的可观察状态（LiveData / StateFlow），自动响应数据变化，实现界面刷新、加载动画、错误提示等。

表示层通过观察业务逻辑层中 ViewModel 暴露的状态数据，实现界面与数据的自动同步更新。

#### 4.1.2 业务逻辑层（Business Logic Layer）

业务逻辑层是系统的核心控制层，负责业务规则处理、状态管理以及业务流程协调。该层作为表示层与数据层之间的中介，避免表示层直接访问数据源。

业务逻辑层主要由以下组件构成：

- **ViewModel 组件**
  接收表示层传入的用户操作，封装业务逻辑并暴露可观察的数据状态供表示层更新界面。
- **业务状态管理**
  维护系统当前业务状态，如天气数据、新闻列表、对话上下文、加载状态和错误状态等。
- **业务协调逻辑**
  对不同业务流程进行协调，例如在查询天气时同时触发新闻更新，或在智能对话中整合上下文与外部数据，保证业务流程完整性和一致性。
- **第三方API集成**
  业务逻辑层还调用了外部服务：
  - 天气查询API（获取城市实时天气信息）
  - 新闻查询API（获取指定城市新闻数据）
  - 智能对话API（处理用户自然语言输入并返回回复）

#### 4.1.3 数据层（Data Layer）

数据层负责系统中所有数据的获取、解析与统一管理，对上层屏蔽具体数据来源的实现细节。

数据层主要由以下组件构成：

- **数据仓库组件（Repository）**
  提供统一的数据访问接口，负责从不同数据源获取数据，并对外提供统一的数据模型。
- **网络数据源（Network Data Source）**
  通过 Retrofit 等网络框架访问外部 API，获取天气信息、新闻数据和智能对话结果。
- **数据模型组件（Data Models）**
  定义系统内部使用的数据结构，如天气模型、新闻模型、对话模型等，保证数据一致性与可复用性。

#### 4.1.4 层间交互关系说明

系统各层之间的依赖关系遵循单向依赖原则：

- 表示层仅依赖业务逻辑层
- 业务逻辑层依赖数据层
- 数据层不依赖表示层和业务逻辑层

系统整体数据流向为：
**表示层 → 业务逻辑层 → 数据层 → 业务逻辑层 → 表示层**

该设计有效降低了系统模块间的耦合度，提升了系统的可扩展性和可维护性。

### 4.2 数据流设计

系统的数据流以用户操作为起点，通过各层协作完成信息获取与展示，整体流程清晰、结构合理。

数据流基本过程如下：

1. 用户在表示层界面中发起操作（如查询天气、浏览新闻或发送对话请求）。
2. 表示层将用户操作请求传递给对应的 ViewModel。
3. ViewModel 根据业务需求调用数据层中的 Repository 接口。
4. Repository 通过网络访问组件向外部服务请求数据。
5. 数据层接收并解析返回的数据，将其封装为统一的数据模型。
6. 数据结果返回至 ViewModel，ViewModel 更新业务状态。
7. 表示层监听到状态变化后，自动刷新界面并展示最新数据。

通过上述数据流设计，实现了界面逻辑、业务逻辑和数据访问逻辑的清晰分离。

## 5 项目亮点与实现原理

### 5.1 技术亮点

1. **MVVM 架构设计**
   - 项目采用 MVVM（Model-View-ViewModel）架构，实现表示层、业务逻辑层和数据层的清晰分离。
   - 优势：界面与业务逻辑解耦，便于扩展、测试和维护；状态驱动界面更新，减少手动刷新代码。
2. **Jetpack Compose 现代界面实现**
   - 使用 Jetpack Compose 构建界面，实现声明式 UI。界面状态由 ViewModel 驱动，数据变化自动触发 UI 更新。
   - 优势：代码简洁、易于维护，支持动态主题和响应式界面效果。
3. **多子系统协同设计**
   - 系统包含 天气查询、新闻查询、智能对话 三个子系统，每个子系统独立管理数据与业务逻辑。
   - 优势：模块化设计便于功能扩展，例如后续增加城市交通信息或景点推荐模块。
4. **统一的数据访问与状态管理**
   - 数据层通过 Repository + 网络数据源 + 数据模型 提供统一接口，屏蔽外部服务差异。
   - ViewModel 管理业务状态并对表示层提供 LiveData/StateFlow 数据流，实现单向数据流和响应式更新。
5. **智能对话功能**
   - 基于外部对话 API，实现简单自然语言理解和回复功能。
   - 支持上下文状态保持，让用户能够进行连续对话，提高交互体验。
6. **跨子系统数据流设计**
   - 数据流遵循“用户操作 → ViewModel → Repository → 网络服务 → ViewModel → UI”的单向流程。
   - 优势：界面、业务逻辑和数据访问逻辑分离，降低耦合度，保证系统稳定性。
7. **扩展性和可维护性高**
   - 新增功能时，只需增加对应子系统的 Repository、ViewModel 和 UI Screen，无需修改现有模块。
   - 使用模块化和接口抽象，外部服务变更对上层影响小。

### 5.2 实现原理

1. **MVVM 架构实现原理**
   - **Model（数据模型）**：封装业务数据结构（如天气信息、新闻条目、对话消息），负责数据的统一解析与存储。
   - **View（表示层）**：UI 层通过观察 ViewModel 中的数据状态（LiveData/StateFlow）实现自动刷新。
   - **ViewModel（业务逻辑层）**：处理用户操作、调用 Repository 获取数据、更新状态，并协调各子系统业务逻辑。
2. **网络数据访问**
   - 使用 Retrofit + Gson 实现对天气 API、新闻 API 和对话 API 的请求与响应解析。
   - Repository 统一封装数据访问接口，返回标准化数据模型，确保上层逻辑无关网络实现细节。
3. **状态驱动界面更新**
   - ViewModel 暴露状态数据，表示层通过 Jetpack Compose State/LiveData 绑定界面。
   - 数据变化立即触发 Compose 重新组合界面，实现界面与数据同步，避免手动刷新和回调困难。
4. **模块化和子系统分离**
   - 每个子系统（天气、新闻、智能对话）独立管理自己的 ViewModel 和 Repository。
   - 共享组件（如网络访问组件、数据模型组件）由公共模块提供，减少重复代码。
5. **智能对话上下文保持**
   - 对话子系统通过 ViewModel 管理对话上下文，用户输入发送至外部对话 API，并将返回结果存储在状态中。
   - 上下文状态可用于多轮对话，使交互更自然。
6. **单向数据流设计**
   - 用户操作 → 表示层 → ViewModel → 数据层 → ViewModel → 表示层
   - 优势：清晰的责任划分，保证状态变更可追踪，减少界面逻辑与业务逻辑交叉问题。

